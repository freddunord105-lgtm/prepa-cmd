<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pr√©paration Commandes ‚Äî SAMEMO</title>

<style>
:root{
  --primary:#0f766e;
  --success:#16a34a;
  --warning:#f59e0b;
  --bg:#f8fafc;
  --card:#ffffff;
  --border:#e5e7eb;
  --disabled:#94a3b8;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
}
.app{max-width:480px;margin:auto;padding:16px}
.header{text-align:center;margin-bottom:16px}
.logo{font-size:28px;font-weight:900;color:var(--primary)}
.subtitle{font-size:14px;color:#475569}
.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.06);
}
h2{text-align:center;margin:0}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
  margin-top:8px;
}
.primary{background:var(--primary);color:#fff}
.success{background:var(--success);color:#fff}
.disabled{background:var(--disabled);cursor:not-allowed}
.list-item{
  padding:12px;
  border-bottom:1px solid var(--border);
}
.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
}
.badge.todo{background:#fff7ed;color:#9a3412}
.badge.done{background:#ecfdf5;color:#065f46}
.hidden{display:none}
.progress{text-align:center;font-weight:700;margin-bottom:12px}
.doneMark{color:var(--success);font-weight:900}

.prep-header{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:12px;
}
.back{
  font-size:22px;
  cursor:pointer;
}
.fake-scan{background:#e5e7eb;font-size:13px}
</style>
</head>

<body>
<div class="app">

<!-- HEADER -->
<div class="header">
  <div class="logo">SAMEMO</div>
  <div class="subtitle">Pr√©paration de commandes</div>
</div>

<!-- FIN -->
<div id="screen-end" class="card hidden">
  <h2>üéâ Toutes les commandes ont √©t√© trait√©es</h2>
  <button class="success" onclick="location.reload()">üîÅ Nouvelle session</button>
</div>

<!-- LISTE COMMANDES -->
<div id="screen-list" class="card">
  <h2>üìã Commandes</h2>
  <div id="orders"></div>
</div>

<!-- PREPA -->
<div id="screen-prep" class="card hidden">
  <div class="prep-header">
    <div class="back" onclick="goBack()">‚¨Ö</div>
    <h2 id="cmdTitle"></h2>
  </div>
  <div id="progress" class="progress"></div>
  <div id="lines"></div>
  <button id="finishPrepBtn" class="disabled" disabled>
    Continuer
  </button>
</div>

<!-- CHOIX BAC -->
<div id="screen-bin" class="card hidden">
  <h2>üß∫ Choisir un bac</h2>
  <div id="bins"></div>
  <button id="confirmBinBtn" class="disabled" disabled>
    Valider le bac
  </button>
</div>

<!-- SCAN BAC -->
<div id="screen-scan" class="card hidden">
  <h2>üì¶ Scanner le bac</h2>
  <p id="scanMsg">Scanne le QR du bac s√©lectionn√©</p>
  <button class="fake-scan" onclick="fakeScanBin()">Simuler scan</button>
</div>

</div>

<script>
/* ===== DATA TEST ===== */

const ORDERS = [
  { id:"CMD-001", client:"Client Alpha", status:"TODO", bin:null },
  { id:"CMD-002", client:"Client Beta", status:"TODO", bin:null }
];

const LINES = {
  "CMD-001":[
    { code:"P001", name:"Produit A", qty:2 },
    { code:"P002", name:"Produit B", qty:1 }
  ],
  "CMD-002":[
    { code:"P003", name:"Produit C", qty:3 }
  ]
};

const BINS = [
  { id:"BAC-001", status:"LIBRE" },
  { id:"BAC-002", status:"OCCUPE" },
  { id:"BAC-003", status:"LIBRE" }
];

/* ===== DOM ===== */

const screenList = document.getElementById("screen-list");
const screenPrep = document.getElementById("screen-prep");
const screenBin  = document.getElementById("screen-bin");
const screenScan = document.getElementById("screen-scan");
const screenEnd  = document.getElementById("screen-end");

const ordersDiv  = document.getElementById("orders");
const linesDiv   = document.getElementById("lines");
const progress   = document.getElementById("progress");
const cmdTitle   = document.getElementById("cmdTitle");
const binsDiv    = document.getElementById("bins");
const scanMsg    = document.getElementById("scanMsg");

const finishPrepBtn = document.getElementById("finishPrepBtn");
const confirmBinBtn = document.getElementById("confirmBinBtn");

/* ===== STATE ===== */

let currentCmd=null;
let lines={}, done={};
let selectedBin=null;

/* ===== LOGIC ===== */

function loadOrders(){
  ordersDiv.innerHTML="";
  ORDERS.forEach(o=>{
    const d=document.createElement("div");
    d.className="list-item";
    d.innerHTML=`
      <strong>${o.id}</strong><br>
      ${o.client}<br>
      <span class="badge ${o.status==='DONE'?'done':'todo'}">
        ${o.status==='DONE'?'Trait√©e':'√Ä pr√©parer'}
      </span><br>
      ${
        o.status==="TODO"
        ? `<button class="primary" onclick="startPrep('${o.id}')">Pr√©parer</button>`
        : `<span class="doneMark">‚úî ${o.bin}</span>`
      }
    `;
    ordersDiv.appendChild(d);
  });

  if(ORDERS.every(o=>o.status==="DONE")){
    screenList.classList.add("hidden");
    screenEnd.classList.remove("hidden");
  }
}

function startPrep(id){
  currentCmd=id;
  lines={}; done={};

  LINES[id].forEach(l=>{
    lines[l.code]={name:l.name,qty:l.qty};
    done[l.code]=0;
  });

  cmdTitle.textContent=`Commande ${id}`;
  finishPrepBtn.disabled=true;
  finishPrepBtn.className="disabled";

  screenList.classList.add("hidden");
  screenPrep.classList.remove("hidden");
  renderLines();
}

function renderLines(){
  linesDiv.innerHTML="";
  let total=0, ok=0;

  for(const c in lines){
    total+=lines[c].qty;
    ok+=done[c];
    const d=document.createElement("div");
    d.className="list-item";
    d.innerHTML=`
      <strong>${lines[c].name}</strong><br>
      ${done[c]} / ${lines[c].qty}
      ${done[c]===lines[c].qty?" ‚úî":""}<br>
      <button class="fake-scan" onclick="fakeScan('${c}')">
        Simuler scan
      </button>
    `;
    linesDiv.appendChild(d);
  }

  progress.textContent=`Avancement : ${ok} / ${total}`;

  if(ok===total){
    finishPrepBtn.disabled=false;
    finishPrepBtn.className="success";
  }
}

function fakeScan(code){
  if(done[code] < lines[code].qty){
    done[code]++;
    renderLines();
  }
}

finishPrepBtn.onclick=()=>{
  screenPrep.classList.add("hidden");
  screenBin.classList.remove("hidden");
  loadBins();
};

function loadBins(){
  binsDiv.innerHTML="";
  selectedBin=null;
  confirmBinBtn.disabled=true;
  confirmBinBtn.className="disabled";

  BINS.filter(b=>b.status==="LIBRE").forEach(b=>{
    const d=document.createElement("div");
    d.className="list-item";
    d.innerHTML=`
      <strong>${b.id}</strong><br>
      <button class="primary" onclick="selectBin('${b.id}')">
        Choisir
      </button>
    `;
    binsDiv.appendChild(d);
  });
}

function selectBin(id){
  selectedBin=id;
  confirmBinBtn.disabled=false;
  confirmBinBtn.className="success";
}

confirmBinBtn.onclick=()=>{
  screenBin.classList.add("hidden");
  screenScan.classList.remove("hidden");
  scanMsg.textContent="Scanne le QR du bac s√©lectionn√©";
};

function fakeScanBin(){
  if(!selectedBin) return;

  scanMsg.textContent=`‚úÖ Bac ${selectedBin} valid√©`;
  scanMsg.style.color="green";

  setTimeout(()=>{
    const o=ORDERS.find(o=>o.id===currentCmd);
    o.status="DONE";
    o.bin=selectedBin;
    BINS.find(b=>b.id===selectedBin).status="OCCUPE";
    goBack();
  },800);
}

function goBack(){
  screenPrep.classList.add("hidden");
  screenBin.classList.add("hidden");
  screenScan.classList.add("hidden");
  screenList.classList.remove("hidden");
  loadOrders();
}

/* INIT */
loadOrders();
</script>

</body>
</html>
